name: Update TLE cache

on:
  schedule:
    - cron: "12 2 * * *"
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Fetch TLEs from CelesTrak
        run: |
          set -euo pipefail
          mkdir -p tle
          UA="tle-mirror/1.0 (github-actions)"
          curl -fsSL -A "$UA" "https://celestrak.org/NORAD/elements/gp.php?GROUP=weather&FORMAT=tle"   -o tle/weather.tle
          curl -fsSL -A "$UA" "https://celestrak.org/NORAD/elements/gp.php?GROUP=stations&FORMAT=tle" -o tle/stations.tle
          curl -fsSL -A "$UA" "https://celestrak.org/NORAD/elements/gp.php?GROUP=active&FORMAT=tle"   -o tle/active.tle
          cat tle/weather.tle tle/stations.tle tle/active.tle > tle/all.tle

      - name: Commit changes
        run: |
          git config user.name  "tle-mirror-bot"
          git config user.email "tle-mirror-bot@users.noreply.github.com"
          git add tle/*.tle
          git diff --cached --quiet || git commit -m "Daily TLE update"
          git push
